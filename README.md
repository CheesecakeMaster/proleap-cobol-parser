cobol85grammar
==================================================

Cobol 85 Grammar for ANTLR4

<a href="https://travis-ci.org/uwol/cobol85grammar"><img src="https://api.travis-ci.org/uwol/cobol85grammar.png"></a>

This is an approximate grammar for Cobol 85. It is akin but neither 
copied from nor identical to Cobol.jj, Cobol.kg and VS COBOL II grammars.
Passes NIST test suite.


Characteristics
---------------

1. Passes the NIST tests.

2. To be used in conjunction with the provided preprocessor, which executes 
   COPY and REPLACE statements.

3. Comment entries are converted to comments.


Example
-------

### Input: COBOL 85 code

```
 Identification Division.
 Program-ID. 
  HELLOWORLD.
 Procedure Division.
  Display "Hello world".
  STOP RUN.
```

### Output: abstract syntax tree (AST)

```
(startRule
	(compilationUnit
		(programUnit
			(identificationDivision Identification Division .
				(programIdParagraph Program-ID .
					(programName
						(cobolWord HELLOWORLD)) . ))
			(procedureDivision Procedure Division .
				(procedureDivisionBody
					(paragraphs
						(sentence
							(statements
								(statement
									(displayStatement Display
										(literal "Hello world")))) .)
						(sentence
							(statements
								(statement
									(stopStatement STOP RUN))) .)))))) <EOF>)
```


Execution
---------

```java
org.cobol85.applicationcontext.Cobol85GrammarContextFactory.configureDefaultApplicationContext();

final java.io.File inputFile = new java.io.File("src/test/resources/org/cobol85/gpl/HelloWorldVar.cbl");
final java.io.File libDirectory = inputFile.getParentFile();

/*
* COBOL preprocessor
*/
// if automatic detection of COBOL line format fails, it has to be set here
final org.cobol85.preprocessor.Cobol85Preprocessor.Cobol85SourceFormatEnum format = org.cobol85.preprocessor.Cobol85Preprocessor.Cobol85SourceFormatEnum.FIXED;
final String preProcessedInput = org.cobol85.applicationcontext.Cobol85GrammarContext.getInstance().getCobol85Preprocessor().process(inputFile, libDirectory, null, format);

/*
* lexer
*/
final org.antlr.v4.runtime.ANTLRInputStream antlrInputStream = new org.antlr.v4.runtime.ANTLRInputStream(preProcessedInput);
final org.cobol85.Cobol85Lexer lexer = new org.cobol85.Cobol85Lexer(antlrInputStream);
final org.antlr.v4.runtime.CommonTokenStream tokens = new org.antlr.v4.runtime.CommonTokenStream(lexer);

/*
* parser
*/
final org.cobol85.Cobol85Parser parser = new org.cobol85.Cobol85Parser(tokens);
final org.cobol85.Cobol85Parser.StartRuleContext ctx = parser.startRule();
```

```java
/*
* traverse the abstract syntax tree (AST) with an ANTLR visitor
*/
final org.cobol85.Cobol85BaseVisitor<Boolean> visitor = new org.cobol85.Cobol85BaseVisitor<Boolean>() {
	/*
	 * exemplary callback function for identification division
	 */
	@Override
	public Boolean visitIdentificationDivision(
			final org.cobol85.Cobol85Parser.IdentificationDivisionContext ctx) {
		return visitChildren(ctx);
	}
};

visitor.visit(ctx);
```


VM args
-------

* For parsing large Cobol source code files,  VM args have to be set: -Xmx2048m -XX:MaxPermSize=256m
* Intellij Plugin for ANTLR 4 has to be provided with those VM args in file idea.vmoptions.


Build process
-------------

* The build process is based on Maven.
* The test suite executes tests against NIST, CICS and some GPLed Cobol test files.
* NIST test files come from [Koopa repo](https://github.com/goblindegook/Koopa/tree/master/testsuite/cobol85).
* Unit tests and parse tree files were generated by class org.cobol85.TestGenerator from COBOL test files. The generator derives the COBOL line format from the containing folder name (e.g. org/cobol85/gpl/fixed). 


Release process
---------------

* Milestones are published in the [ANTLR grammars repo](https://github.com/antlr/grammars-v4).


License
-------

Licensed under the BSD 3-Clause License. See LICENSE for details.

### And finally...

Patches accepted, or create an issue! 
I'd love, if you could send me a note in which context you're using the grammar. Thank you!